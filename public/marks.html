<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Student Dropout Predictor</title>
      <style>    body {      font-family: Arial, sans-serif;      max-width: 800px;      margin: 50px auto;      padding: 20px;    }    .form-section, .chat-section {      margin-bottom: 30px;    }    .chat-section {      display: none;    }    .chat-section.active {      display: block;    }    input, button {      padding: 8px;      margin: 5px 0;    }    button {      cursor: pointer;    }    #chatbox {      border: 1px solid #ccc;      height: 400px;      overflow-y: auto;      padding: 10px;      margin-bottom: 10px;    }    .message {      margin: 10px 0;      padding: 8px;    }    .message.bot {      background: #e3f2fd;    }    .message.user {      background: #f5f5f5;      text-align: right;    }  </style>
   </head>
   <body>
      <h1>Student Dropout Predictor</h1>
      <!-- Form Section -->  
      <div class="form-section" id="formSection">
         <h2>Enter Your Information</h2>
         <p>Note: Subject marks are optional. Leave blank if you don't have them.</p>
         <form id="studentForm">
            <div>        <label>Aadhar Card:</label><br>        <input type="text" id="studentId" name="studentId" required>      </div>
            <h3>Subject Marks (Optional)</h3>
            <div>        <label>English (0-100):</label><br>        <input type="number" id="english" name="english" min="0" max="100">      </div>
            <div>        <label>Marathi (0-100):</label><br>        <input type="number" id="marathi" name="marathi" min="0" max="100">      </div>
            <div>        <label>Hindi (0-100):</label><br>        <input type="number" id="hindi" name="hindi" min="0" max="100">      </div>
            <div>        <label>Social Science (0-100):</label><br>        <input type="number" id="social_science" name="social_science" min="0" max="100">      </div>
            <div>        <label>Science (0-100):</label><br>        <input type="number" id="science" name="science" min="0" max="100">      </div>
            <div>        <label>Maths (0-100):</label><br>        <input type="number" id="maths" name="maths" min="0" max="100">      </div>
            <br>      <button type="submit">Start Assessment</button>    
         </form>
      </div>
      <!-- Chat Section -->  
      <div class="chat-section" id="chatSection">
         <h2>Chat Assessment</h2>
         <div id="chatbox"></div>
         <input type="text" id="userInput" placeholder="Type your answer...">    <button id="sendBtn">Send</button>  
      </div>
      <script>
        let studentId = null;
        let providedMarks = {};
        // Function 1: Form submission handler
        document.getElementById('studentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            studentId = document.getElementById('studentId').value;
            providedMarks = {};
            const subjects = ['english', 'marathi', 'hindi', 'social_science', 'science', 'maths'];
            subjects.forEach(subject => {
            const value = document.getElementById(subject).value;
            if (value !== '') {
                providedMarks[subject] = parseInt(value);
            }
            });
            console.log('Starting chat for:', studentId, providedMarks);
            document.getElementById('formSection').style.display = 'none';
            document.getElementById('chatSection').classList.add('active');
            await initializeChat();
        });
        // Function 2: Initialize chat
        async function initializeChat() {
            try {
            const response = await fetch('/api/start-chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                studentId: studentId,
                providedMarks: providedMarks
                })
            });
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();
            addMessage(data.message, 'bot');
            if (data.completed) {
                displayResults(data);
            }
            } catch (error) {
            console.error('Error:', error);
            addMessage('Error starting chat. Please try again.', 'bot');
            }
        }
        // Function 3 & 4: Event listeners
        document.getElementById('sendBtn').addEventListener('click', sendMessage);
        document.getElementById('userInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
        // Function 5: Send message
        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            if (!message) return;
            addMessage(message, 'user');
            input.value = '';
            try {
            const response = await fetch('/api/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                studentId: studentId,
                message: message
                })
            });
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();
            addMessage(data.message, 'bot');
            if (data.completed) {
                displayResults(data);
            }
            } catch (error) {
            console.error('Error:', error);
            addMessage('Error. Please try again.', 'bot');
            }
        }
        // Function 6: Add message
        function addMessage(text, sender) {
            const chatbox = document.getElementById('chatbox');
            const div = document.createElement('div');
            div.className = `message ${sender}`;
            div.textContent = text;
            chatbox.appendChild(div);
            chatbox.scrollTop = chatbox.scrollHeight;
        }
        // Function 7: Display results
        function displayResults(data) {
            if (data.prediction) {
            const result = `
        Results:
        - Risk Level: ${data.prediction.riskLevel}
        - Risk Score: ${data.prediction.riskScore}/100
        - Will Dropout: ${data.prediction.willDropout ? 'YES' : 'NO'}
            `;
            addMessage(result, 'bot');
            if (data.prediction.reasons && data.prediction.reasons.length > 0) {
                addMessage('Reasons: ' + data.prediction.reasons.join(', '), 'bot');
            }
            if (data.prediction.recommendation) {
                addMessage('Recommendation: ' + data.prediction.recommendation, 'bot');
            }
            }
            document.getElementById('userInput').disabled = true;
            document.getElementById('sendBtn').disabled = true;
        }
        </script>
   </body>
</html>